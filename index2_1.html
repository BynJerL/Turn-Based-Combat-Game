<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layout Template</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 11px;
        }

        button {
            font-size: 11px;
        }

        .container {
            width: 300px;
            background-color: coral;
        }

        .top-bar {
            height: 30px;
            background-color: aquamarine;
        }

        .stage-bar {
            height: 200px;
            display: flex;
            background-color: bisque;
        }

        .queue-bar {
            display: flex;
            flex-direction: column;
            width: 50px;
            background-color: chartreuse;
            gap: 1px;
        }

        .ally-team {
            width: 100px;
            background-color: cornflowerblue;
        }
        
        .enemy-team {
            width: 150px;
            background-color: darkorange;
        }

        .info-bar {
            height: 85px;
            background-color: fuchsia;
        }

        .option-bar {
            height: 46px;
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            margin-top: 5px;
            background-color: darkkhaki;
            overflow: auto;
        }

        .option {
            width: 90px;
        }

        .bottom-info-bar {
            height: 20px;
            display: flex;
            justify-content: space-between;
            /* align-items: center; */
            background-color: darksalmon;
        }

        .action-info {
            width: 250px;
        }

        .bottom-bar {
            display: flex;
        }

        .character-bar {
            display: flex;
            gap: 5px;
            align-items: c;
            background-color: lightgreen;
            width: 180px;
            height: 60px;
        }

        .character-card {
            background-color: gold;
            width: 40px;
            height: 45px;
        }

        .team-display {
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 5px;
        }

        .queue-item {
            height: 14px;
            background-color: lightsteelblue;
        }

        .act-chara-pic {
            background-color: mediumorchid;
            width: 50px;
            height: 50px;
        }

        .act-chara-name {
            font-weight: 600;
        }

        .property-bar {
            display: flex;
            gap: 5px;
        }

        .property-name {
            width: 15px;
        }

        .property-value {
            font-style: italic;
        }

        .action-bar {
            background-color: lightyellow;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            width: 120px;
        }

        .action-button {
            font-size: 9px;
            width: 40px;
        }
    </style>
</head>
<body>
    <section class="container">
        <section class="top-bar">Top Bar</section>
        <section class="stage-bar">
            <section class="queue-bar">Queue</section>
            <section class="ally-team team-display">Ally Team</section>
            <section class="enemy-team team-display">Enemy Team</section>
        </section>
        <section class="info-bar">
            <div class="log-bar">Log</div>
            <div class="option-bar">
                <button class="option">Option 1</button>
                <button class="option">Option 2</button>
                <button class="option">Option 3</button>
                <button class="option">Option 4</button>
            </div>
            <div class="bottom-info-bar">
                <div class="action-info">Action Info</div>
                <button class="next-button" disabled>Next</button>
            </div>
        </section>
        <section class="bottom-bar">
            <section class="character-bar">
                <div class="act-chara-pic">Acting Character Picture</div>
                <div class="act-chara-info">
                    <div class="act-chara-name"></div>
                    <div class="act-chara-hp property-bar">
                        <div class="property-name">HP</div>
                        <div class="property-value"></div>
                    </div>
                    <div class="act-chara-sp property-bar">
                        <div class="property-name">SP</div>
                        <div class="property-value"></div>
                    </div>
                </div>
            </section>
            <section class="action-bar">
                <button class="action-button">Basic Attack</button>
                <button class="action-button">Defend</button>
                <button class="action-button">Use Skill</button>
                <button class="action-button">Use Item</button>
                <button class="action-button">Check Info</button>
                <button class="action-button">Retreat</button>
            </section>
        </section>
    </section>

    <script>
        const allyTeamSection = document.querySelector(".ally-team");
        const enemyTeamSection = document.querySelector(".enemy-team");
        const optionBar = document.querySelector('.option-bar');
        const queueBar = document.querySelector(".queue-bar");
        const actionButtons = document.querySelectorAll(".action-button");

        const CharacterType = Object.freeze({
            ALLY: "Ally",
            ENEMY: "Enemy"
        })

        class Character {
            /** 
             * @param {string} name,
             * @param {CharacterType} type, 
             * @param {number} hp, 
             * @param {number} sp, 
             * @param {number} attack, 
             * @param {number} defense, 
             * @param {number} speed
             * */
            constructor (name, type, hp, sp, attack, defense, speed) {
                this.name = name;
                this.type = type;
                this.max_hp = hp;
                this.curr_hp = hp;
                this.max_sp = sp;
                this.curr_sp = sp;
                this.attack = attack;
                this.defense = defense;
                this.speed = speed
                this.is_alive = true;
            }
        }

        const BattleManager = {
            ally_team: [
                new Character("A1", CharacterType.ALLY, 180, 20, 20, 20, 120),
                new Character("A2", CharacterType.ALLY, 200, 18, 22, 22, 115),
                new Character("A3", CharacterType.ALLY, 250, 16, 25, 24, 110),
            ],
            enemy_team: [
                new Character("E1", CharacterType.ENEMY, 80, 5, 8, 8, 112),
                new Character("E2", CharacterType.ENEMY, 80, 5, 8, 8, 111),
                new Character("E3", CharacterType.ENEMY, 80, 5, 8, 8, 110),
                new Character("E4", CharacterType.ENEMY, 100, 2, 10, 10, 109),
                new Character("E5", CharacterType.ENEMY, 100, 2, 10, 10, 108),
                new Character("E6", CharacterType.ENEMY, 100, 2, 10, 10, 107),
                new Character("E7", CharacterType.ENEMY, 100, 2, 10, 10, 106),
            ],
            acting_character : null,
            turn_queue : [],
            updateTurnQueue() {
                this.turn_queue = [].concat(this.ally_team, this.enemy_team).sort(function(a, b) {return b.speed - a.speed});
            },
            updateActingCharacter() {
                this.acting_character = this.turn_queue[0];
            }
        };

        const UIManager = {
            init () {
                actionButtons[0].onclick = () => this.showTargets(); 
                this.initTeamDisplay();
            },
            initTeamDisplay () {
                allyTeamSection.innerHTML = BattleManager.ally_team.map(
                    chara => `<div class="character-card">${chara.name}</div>`
                ).join('');

                enemyTeamSection.innerHTML = BattleManager.enemy_team.map(
                    chara => `<div class="character-card">${chara.name}</div>`
                ).join('');
            },
            updateActingCharacter () {
                const acting_character = BattleManager.acting_character;
                document.querySelector(".act-chara-name").textContent = acting_character.name;
                document.querySelector(".act-chara-hp .property-value").textContent = `${acting_character.curr_hp}/${acting_character.max_hp}`;
                document.querySelector(".act-chara-sp .property-value").textContent = `${acting_character.curr_sp}/${acting_character.max_sp}`;
            },
            updateTurnQueue () {
                queueBar.innerHTML = BattleManager.turn_queue.map(
                    chara => `<div class="queue-item">${chara.name}</div>`
                ).join('');
            },
            showTargets () {
                optionBar.innerHTML = BattleManager.enemy_team.filter(chara => chara.is_alive).map(
                    chara => `<button class="option">${chara.name}</button>`
                ).join('');
            }
        };

        BattleManager.updateTurnQueue();
        BattleManager.updateActingCharacter();
        UIManager.init();
        UIManager.updateTurnQueue();
        UIManager.updateActingCharacter();
        // UIManager.showTargets();

    </script>
</body>
</html>